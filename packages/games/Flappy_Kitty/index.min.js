var a,t,i,n,o,l,r,d,s,h,w,u,c,e,f,y,g,p,m,v,b,x,T,S,E,P,H,k,A,G,B,O,W,_,M,C,N;var U,I,F,q,z,R,j,K,L,V,D,Y;var J=false;t=false;u=160;o=1100;i=320;w=1/1200;s=400;h=1;d=window.innerHeight;c=window.innerWidth;n=window.innerHeight;l=64;r=d-l;B=document.querySelector("#screen");E=void 0;T=void 0;m=[];p=[];g=[];f=null;C=null;A=null;y=null;P=null;O=null;_=null;k=null;S=null;b=null;W=null;H=null;v=null;M=null;N=null;x=Math.floor;rebuildGame=function(){t=false;u=160;o=1100;i=320;w=1/1200;s=400;h=1;d=window.innerHeight;c=window.innerWidth;n=window.innerHeight;l=64;r=d-l;x=Math.floor;try{Phaser.Canvas.setSmoothingEnabled(a.context,false);a.stage.scale.height=window.innerHeight;a.stage.scale.width=window.innerWidth;a.stage.scaleMode=Phaser.StageScaleMode.AUTO;a.stage.scale.setScreenSize(true);a.world.width=c;a.world.height=d;a.width=c;a.height=d;f.width=c;f.height=d;_.x=a.world.width/2;_.y=a.world.height/4;P.x=0;P.y=r;P.width=window.innerWidth;k.x=a.world.width/2;k.y=a.world.height-a.world.height/4;S.x=a.world.width/2;S.y=a.world.height/2;document.getElementsByTagName("canvas")[0].width=window.innerWidth;document.getElementsByTagName("canvas")[0].height=window.innerHeight;document.getElementsByTagName("canvas")[0].style.width=window.innerWidth+"px";document.getElementsByTagName("canvas")[0].style.height=window.innerHeight+"px";_.setText(i18n("Flappy Kitty"));k.setText(i18n("TOUCH TO FLAP"));S.renderable=false;y.destroy();y=a.add.sprite(0,0,"bird");y.anchor.setTo(.5,.5);y.body.allowGravity=false;y.reset(a.world.width*.3,a.world.height/2);f.reset(0,0);y.angle=0;y.animations.play("fly");A.removeAll();C.destroy();a.time.events.remove(N);C=a.add.group();E=false}catch(e){}};mainGame=function(){K=function(e,t){var i,n,o;i=null;n=t?"tubeTop":"tubeBottom";if(t){o=x(e-s/2-320)}else{o=x(e+s/2)}if(m.length>0&&n==="tubeTop"){i=m.pop().revive();i.reset(a.world.width,o)}else if(p.length>0&&n==="tubeBottom"){i=p.pop().revive();i.reset(a.world.width,o)}else{i=C.create(a.world.width,o,n);i.body.allowGravity=false}i.body.velocity.x=-u;return i};L=function(){var e,t,i,n;C.forEachAlive(function(e){if(e.x+e.width<a.world.bounds.left){if(e.key==="tubeTop"){m.push(e.kill())}if(e.key==="tubeBottom"){p.push(e.kill())}}});A.forEachAlive(function(e){if(e.x+e.width<a.world.bounds.left){g.push(e.kill())}});n=a.world.height/4+(Math.random()-.5)*a.world.height*.2;e=K(n);i=K(n,true);if(g.length>0){t=g.pop().revive().reset(i.x+i.width/2,0)}else{t=A.create(i.x+i.width/2,0);t.width=2;t.height=a.world.height;t.body.allowGravity=false}t.body.velocity.x=-u};U=function(e,t){A.remove(t);O+=1;_.setText(O);W.play()};j=function(){var e;T=true;if(y.body.velocity.y>0){y.body.velocity.y=100}y.animations.stop();y.frame=1;k.setText(i18n("TOUCH")+"\n"+i18n("TO TRY AGAIN"));k.renderable=true;e=localStorage.flappy_high_score;e=e?e:O;e=O>parseInt(e,10)?O:e;localStorage.flappy_high_score=e;refreshUpdateHighScore();S.setText(i18n("GAMEOVER")+"\n\n"+i18n("HIGH SCORE")+"\n\n"+e);S.renderable=true;C.forEachAlive(function(e){e.body.velocity.x=0});A.forEach(function(e){e.body.velocity.x=0});a.time.events.remove(N);a.time.events.add(1e3,function(){return a.input.onTap.addOnce(function(){R();return M.play()})});H.play();monitizeShowInterstitial()};F=function(){var e;if(!E){V()}if(!T){y.body.gravity.y=0;y.body.velocity.y=-100;e=a.add.tween(y.body.velocity).to({y:-i},25,Phaser.Easing.Bounce.In,true);e.onComplete.add(function(){return y.body.gravity.y=o});b.play()}};q=function(){var i;i={spritesheet:{bird:["assets/cat.png",36,36]},image:{tubeTop:["assets/tube1.png"],tubeBottom:["assets/tube2.png"],ground:["assets/ground.png"],bg:["assets/bg.png"]},audio:{flap:["assets/sfx_wing.mp3"],score:["assets/sfx_point.mp3"],hurt:["assets/sfx_hit.mp3"],fall:["assets/sfx_die.mp3"],swoosh:["assets/sfx_swooshing.mp3"]}};Object.keys(i).forEach(function(t){Object.keys(i[t]).forEach(function(e){a.load[t].apply(a.load,[e].concat(i[t][e]))})})};I=function(){var e;e=window.innerWidth/window.innerHeight;document.querySelector("#loading").style.display="none";document.querySelector("#loading_overlay").style.display="none";Phaser.Canvas.setSmoothingEnabled(a.context,false);a.stage.scaleMode=Phaser.StageScaleMode.AUTO;a.stage.scale.setScreenSize(true);a.world.width=window.innerWidth;a.world.height=window.innerHeight;f=a.add.tileSprite(0,0,window.innerWidth,window.innerHeight,"bg");C=a.add.group();A=a.add.group();y=a.add.sprite(0,0,"bird");y.anchor.setTo(.5,.5);y.animations.add("fly",[0,1,2],10,true);y.body.collideWorldBounds=true;y.body.setPolygon(24,1,34,16,30,32,20,24,12,34,2,12,14,2);P=a.add.tileSprite(0,r,window.innerWidth,l,"ground");P.tileScale.setTo(h,h);_=a.add.text(a.world.width/2,a.world.height/4,"",{font:'16px "Press Start 2P"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"center"});_.anchor.setTo(.5,.5);k=a.add.text(a.world.width/2,a.world.height-a.world.height/4,"",{font:'8px "Press Start 2P"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"center"});k.anchor.setTo(.5,.5);S=a.add.text(a.world.width/2,a.world.height/2,"",{font:'16px "Press Start 2P"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"center"});S.anchor.setTo(.5,.5);S.scale.setTo(h,h);b=a.add.audio("flap");W=a.add.audio("score");H=a.add.audio("hurt");v=a.add.audio("fall");M=a.add.audio("swoosh");a.input.onDown.add(F);R()};R=function(){C.removeAll();A.removeAll();E=false;T=false;O=0;_.setText(i18n("Flappy Kitty"));k.setText(i18n("TOUCH TO FLAP"));S.renderable=false;y.body.allowGravity=false;y.reset(a.world.width*.3,a.world.height/2);f.reset(0,0);y.angle=0;y.animations.play("fly")};V=function(){y.body.allowGravity=true;y.body.gravity.y=o;N=a.time.events.loop(1/w,L);_.setText(O);k.renderable=false;E=true};Y=function(){var e;if(E){if(!T){y.angle=90*(i+y.body.velocity.y)/i-180;if(y.angle<-30){y.angle=-30}if(y.angle>80){y.angle=90;y.animations.stop();y.frame=1}else{y.animations.play()}a.physics.overlap(y,C,function(){j();return v.play()});if(!T&&y.body.bottom>=r){j()}a.physics.overlap(y,A,U)}else{e=a.add.tween(y).to({angle:90},100,Phaser.Easing.Bounce.Out,true);if(y.body.bottom>=r+3){y.y=r-13;y.body.velocity.y=0;y.body.allowGravity=false;y.body.gravity.y=0}}}else{y.y=a.world.height/2+8*Math.cos(a.time.now/200);y.angle=0}if(!T){P.tilePosition.x-=a.time.physicsElapsed*u}};z=function(){if(t){a.debug.renderSpriteBody(y);C.forEachAlive(function(e){a.debug.renderSpriteBody(e)});A.forEach(function(e){a.debug.renderSpriteBody(e)})}};D={preload:q,create:I,update:Y,render:z};a=new Phaser.Game(window.innerWidth,window.innerHeight,Phaser.CANVAS,B,D,false,false)};e={google:{families:["Press+Start+2P::latin"]},active:rebuildGame};$(document).ready(function(){rebuildGame();mainGame()});